# èœå•é¡µé¢ä¸€ç›´åŠ è½½ä¸­çš„ä¿®å¤æ–¹æ¡ˆ

> é—®é¢˜ï¼šè®¿é—® http://localhost:3000/api/admin/menus é¡µé¢ä¸€ç›´æ˜¾ç¤ºåŠ è½½ä¸­
> ä¿®å¤æ—¶é—´: 2026-01-28

---

## ğŸ” é—®é¢˜åˆ†æ

### å¯èƒ½çš„åŸå› 

1. **å“åº”æ•°æ®æ ¼å¼å¤„ç†ä¸å½“**
   - åç«¯è¿”å›æ ¼å¼: `{ code: 200, msg: "è·å–æˆåŠŸ", data: { list: [...], total: 10 } }`
   - å‰ç«¯å¤„ç†é€»è¾‘å¯èƒ½ä¸æ­£ç¡®

2. **è¯·æ±‚è¶…æ—¶æ—¶é—´è¿‡çŸ­**
   - åŸè¶…æ—¶æ—¶é—´: 10ç§’
   - å¯èƒ½ä¸å¤Ÿç”¨

3. **æ•°æ®åº“ä¸­æ²¡æœ‰èœå•æ•°æ®**
   - é¦–æ¬¡å¯åŠ¨æ—¶å¯èƒ½æ²¡æœ‰åˆå§‹èœå•

4. **è®¤è¯tokené—®é¢˜**
   - Tokenè¿‡æœŸæˆ–ä¸å­˜åœ¨å¯¼è‡´401é”™è¯¯

---

## âœ… å·²å®æ–½çš„ä¿®å¤

### 1. ä¼˜åŒ–å“åº”æ•°æ®å¤„ç† (menus/index.vue)

**ä¿®æ”¹ä½ç½®**: `admin/frontend/src/views/system/menus/index.vue`

**ä¿®æ”¹å†…å®¹**:
```javascript
const loadMenus = async () => {
  loading.value = true
  try {
    console.log('å¼€å§‹åŠ è½½èœå•...')
    const res = await getMenuList()
    console.log('èœå•æ¥å£è¿”å›:', res)
    
    // å¤„ç†ä¸åŒçš„æ•°æ®æ ¼å¼
    let menuList = []
    if (res?.data?.list) {
      menuList = res.data.list
    } else if (res?.list) {
      menuList = res.list
    } else if (res?.data) {
      // å¦‚æœ data æ˜¯æ•°ç»„ï¼Œç›´æ¥ä½¿ç”¨
      if (Array.isArray(res.data)) {
        menuList = res.data
      } else if (res.data.list) {
        menuList = res.data.list
      }
    } else if (Array.isArray(res)) {
      menuList = res
    }
    
    console.log('å¤„ç†åçš„èœå•æ•°æ®:', menuList)
    tableData.value = menuList
  } catch (error) {
    console.error('åŠ è½½èœå•å¤±è´¥:', error)
    ElMessage.error(error.message || 'è·å–èœå•åˆ—è¡¨å¤±è´¥')
  } finally {
    loading.value = false
  }
}
```

**æ”¹è¿›ç‚¹**:
- âœ… æ·»åŠ è¯¦ç»†çš„consoleæ—¥å¿—ï¼Œä¾¿äºè°ƒè¯•
- âœ… æ”¹è¿›æ•°æ®æ ¼å¼åˆ¤æ–­é€»è¾‘
- âœ… ç¡®ä¿loadingçŠ¶æ€æ­£ç¡®å…³é—­

### 2. ä¼˜åŒ–è¯·æ±‚æ‹¦æˆªå™¨ (request.js)

**ä¿®æ”¹ä½ç½®**: `admin/frontend/src/utils/request.js`

**ä¿®æ”¹1: å¢åŠ è¶…æ—¶æ—¶é—´**
```javascript
const service = axios.create({
  baseURL: import.meta.env.VITE_API_BASE_URL || '',
  timeout: 30000  // ä»10ç§’å¢åŠ åˆ°30ç§’
})
```

**ä¿®æ”¹2: æ”¹è¿›å“åº”å¤„ç†**
```javascript
service.interceptors.response.use(
  response => {
    const res = response.data
    console.log('å“åº”æ•°æ®:', res)
    
    // æ£€æŸ¥å“åº”æ ¼å¼
    if (res.code !== undefined) {
      if (res.code !== 200) {
        ElMessage.error(res.msg || 'è¯·æ±‚å¤±è´¥')

        // 401: æœªæˆæƒ
        if (res.code === 401) {
          ElMessageBox.confirm('ç™»å½•çŠ¶æ€å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•', 'æç¤º', {
            confirmButtonText: 'é‡æ–°ç™»å½•',
            cancelButtonText: 'å–æ¶ˆ',
            type: 'warning'
          }).then(() => {
            localStorage.removeItem('token')
            router.push('/login')
          })
        }
        return Promise.reject(new Error(res.msg || 'è¯·æ±‚å¤±è´¥'))
      }
      // æˆåŠŸå“åº”ï¼Œè¿”å›å®Œæ•´æ•°æ®ï¼ˆåŒ…æ‹¬ code, msg, dataï¼‰
      return res
    }
    // å¦‚æœæ²¡æœ‰codeå­—æ®µï¼Œç›´æ¥è¿”å›ï¼ˆå¯èƒ½ä¸æ˜¯æ ‡å‡†æ ¼å¼ï¼‰
    return res
  },
```

**æ”¹è¿›ç‚¹**:
- âœ… å¢åŠ è¶…æ—¶æ—¶é—´åˆ°30ç§’
- âœ… ä¿®å¤å“åº”è¿”å›æ ¼å¼ï¼Œç¡®ä¿è¿”å›å®Œæ•´æ•°æ®
- âœ… ç¡®ä¿æˆåŠŸæ—¶è¿”å› `{ code, msg, data }` å®Œæ•´å¯¹è±¡

---

## ğŸ”§ æ’æŸ¥æ­¥éª¤

### æ­¥éª¤1: æ£€æŸ¥åç«¯æ˜¯å¦æ­£å¸¸è¿è¡Œ

```bash
# æµ‹è¯•åç«¯æ˜¯å¦å¯è®¿é—®
curl http://localhost:8081/api/test

# åº”è¯¥è¿”å›: {"msg":"åç«¯æ­£å¸¸è¿è¡Œ"}
```

### æ­¥éª¤2: æ£€æŸ¥èœå•æ¥å£æ˜¯å¦è¿”å›æ•°æ®

æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰ï¼Œè¿›å…¥ Network æ ‡ç­¾ï¼š
1. åˆ·æ–°èœå•é¡µé¢
2. æŸ¥æ‰¾ `/api/admin/menus` è¯·æ±‚
3. æŸ¥çœ‹å“åº”å†…å®¹

**é¢„æœŸå“åº”**:
```json
{
  "code": 200,
  "msg": "è·å–æˆåŠŸ",
  "data": {
    "list": [...],  // èœå•æ•°æ®
    "total": 10
  }
}
```

**å¯èƒ½çš„é—®é¢˜å“åº”**:
- 401é”™è¯¯: Tokenè¿‡æœŸæˆ–ä¸å­˜åœ¨
- 500é”™è¯¯: åç«¯æœåŠ¡é”™è¯¯
- ç©ºæ•°æ®: æ•°æ®åº“ä¸­æ²¡æœ‰èœå•

### æ­¥éª¤3: æ£€æŸ¥Consoleæ—¥å¿—

æ‰“å¼€æµè§ˆå™¨ Console æ ‡ç­¾ï¼ŒæŸ¥çœ‹ä»¥ä¸‹æ—¥å¿—ï¼š
- "å¼€å§‹åŠ è½½èœå•..."
- "èœå•æ¥å£è¿”å›: ..."
- "å¤„ç†åçš„èœå•æ•°æ®: ..."

**æ­£å¸¸æƒ…å†µ**:
```
å¼€å§‹åŠ è½½èœå•...
å“åº”æ•°æ®: {code: 200, msg: "è·å–æˆåŠŸ", data: {...}}
èœå•æ¥å£è¿”å›: {code: 200, msg: "è·å–æˆåŠŸ", data: {...}}
å¤„ç†åçš„èœå•æ•°æ®: [...]
```

**å¼‚å¸¸æƒ…å†µ**:
```
åŠ è½½èœå•å¤±è´¥: Error: æœªæä¾›è®¤è¯token
åŠ è½½èœå•å¤±è´¥: Error: ç½‘ç»œé”™è¯¯
```

### æ­¥éª¤4: æ£€æŸ¥æ•°æ®åº“ä¸­æ˜¯å¦æœ‰èœå•æ•°æ®

```sql
-- æŸ¥çœ‹èœå•è¡¨
SELECT * FROM menus;

-- å¦‚æœæ²¡æœ‰æ•°æ®ï¼Œæ’å…¥åˆå§‹èœå•
INSERT INTO menus (name, type, path, component, icon, sort, status, parent_id)
VALUES 
('ç”¨æˆ·ç®¡ç†', 2, '/users', '/views/system/user/index', 'User', 1, 1, NULL),
('è§’è‰²ç®¡ç†', 2, '/roles', '/views/system/role/index', 'Lock', 2, 1, NULL),
('èœå•ç®¡ç†', 2, '/menus', '/views/system/menu/index', 'Menu', 3, 1, NULL);
```

---

## ğŸ¯ å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### é—®é¢˜1: æ˜¾ç¤º"æœªæä¾›è®¤è¯token"

**åŸå› **: Tokenè¿‡æœŸæˆ–ä¸å­˜åœ¨

**è§£å†³**:
1. æ¸…é™¤æµè§ˆå™¨ localStorage
2. é‡æ–°ç™»å½•
3. æ£€æŸ¥tokenæ˜¯å¦æ­£ç¡®å­˜å‚¨

```javascript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°æ‰§è¡Œ
localStorage.clear()
```

### é—®é¢˜2: ä¸€ç›´åŠ è½½ä¸­ï¼ŒConsoleæ— é”™è¯¯

**åŸå› **: å¯èƒ½æ˜¯ç©ºæ•°æ®å¯¼è‡´çš„å¾ªç¯

**è§£å†³**:
1. æ£€æŸ¥åç«¯è¿”å›çš„æ•°æ®
2. ç¡®ä¿æ•°æ®åº“ä¸­æœ‰èœå•æ•°æ®
3. æ‰‹åŠ¨æ·»åŠ æµ‹è¯•èœå•

### é—®é¢˜3: è¯·æ±‚è¶…æ—¶

**åŸå› **: ç½‘ç»œé—®é¢˜æˆ–åç«¯å“åº”æ…¢

**è§£å†³**:
1. æ£€æŸ¥åç«¯æ˜¯å¦æ­£å¸¸
2. å¢åŠ è¶…æ—¶æ—¶é—´ï¼ˆå·²å¢åŠ åˆ°30ç§’ï¼‰
3. æ£€æŸ¥æ•°æ®åº“è¿æ¥

### é—®é¢˜4: æ˜¾ç¤º"è·å–èœå•åˆ—è¡¨å¤±è´¥"

**åŸå› **: åç«¯è¿”å›é”™è¯¯

**è§£å†³**:
1. æŸ¥çœ‹å…·ä½“é”™è¯¯ä¿¡æ¯
2. æ£€æŸ¥åç«¯æ—¥å¿—
3. ä¿®å¤åç«¯é”™è¯¯

---

## ğŸ“ åç»­ä¼˜åŒ–å»ºè®®

### 1. æ·»åŠ é”™è¯¯è¾¹ç•Œå¤„ç†
```javascript
const loadMenus = async () => {
  if (!localStorage.getItem('token')) {
    ElMessage.warning('è¯·å…ˆç™»å½•')
    router.push('/login')
    return
  }
  
  loading.value = true
  // ... åŸæœ‰é€»è¾‘
}
```

### 2. æ·»åŠ é‡è¯•æœºåˆ¶
```javascript
let retryCount = 0
const loadMenus = async () => {
  try {
    // ... åŸæœ‰é€»è¾‘
    retryCount = 0  // æˆåŠŸåé‡ç½®
  } catch (error) {
    if (retryCount < 3) {
      retryCount++
      setTimeout(() => loadMenus(), 1000)
    } else {
      ElMessage.error('åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•')
    }
  }
}
```

### 3. æ·»åŠ ç©ºçŠ¶æ€æç¤º
```vue
<el-empty v-if="!loading && tableData.length === 0" description="æš‚æ— èœå•æ•°æ®" />
```

---

## ğŸ§ª æµ‹è¯•éªŒè¯

### æµ‹è¯•æ¸…å•

- [ ] åç«¯æœåŠ¡æ­£å¸¸è¿è¡Œ (8081)
- [ ] å‰ç«¯å¯ä»¥è®¿é—®åç«¯æ¥å£
- [ ] èœå•é¡µé¢å¯ä»¥æ­£å¸¸åŠ è½½
- [ ] èœå•æ•°æ®æ­£ç¡®æ˜¾ç¤º
- [ ] å¯ä»¥æ·»åŠ èœå•
- [ ] å¯ä»¥ç¼–è¾‘èœå•
- [ ] å¯ä»¥åˆ é™¤èœå•
- [ ] åŠ è½½çŠ¶æ€æ­£ç¡®æ˜¾ç¤º/éšè—

### æµ‹è¯•æ­¥éª¤

1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·
2. è®¿é—® http://localhost:3000
3. ç™»å½•ç®¡ç†åå°
4. è¿›å…¥"ç³»ç»Ÿç®¡ç†" -> "èœå•ç®¡ç†"
5. æ£€æŸ¥:
   - åŠ è½½åŠ¨ç”»æ˜¯å¦æ­£å¸¸æ˜¾ç¤º/éšè—
   - èœå•åˆ—è¡¨æ˜¯å¦æ­£å¸¸æ˜¾ç¤º
   - Console æ˜¯å¦æœ‰é”™è¯¯
   - Network è¯·æ±‚æ˜¯å¦æ­£å¸¸

---

## ğŸ“š ç›¸å…³æ–‡ä»¶

### ä¿®æ”¹çš„æ–‡ä»¶
1. `admin/frontend/src/views/system/menus/index.vue` - èœå•é¡µé¢
2. `admin/frontend/src/utils/request.js` - è¯·æ±‚å·¥å…·

### ç›¸å…³æ–‡ä»¶
1. `admin/backend/handlers/menu.go` - èœå•å¤„ç†å™¨
2. `admin/frontend/src/api/menu.js` - èœå•API

---

**ä¿®å¤å®Œæˆæ—¶é—´**: 2026-01-28
**ä¿®å¤ç‰ˆæœ¬**: v1.0.1
